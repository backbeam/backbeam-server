- var formid = 'form-'+id()
br
form(role='form', method='post', action='#{req.baseUrl}/web/controller', id=formid)
  input(type='hidden', name='filename', value=req.params.filename)
  .row
    .col-lg-12
      .form-group
        .input-group
          span.input-group-addon
            - var methods = ['GET', 'POST', 'PUT', 'DELETE']
            select(name='method')
              each method in methods
                option(value=method, selected=(route.method === method ? 'selected' : undefined))= method
          input.form-control(type='text', name='path', value=route.path)
          span.input-group-btn
            button.btn.btn-primary(type='submit') Save changes
            a.btn.btn-info Test
            a.btn.btn-danger(href=nolink, data-url='#{req.baseUrl}/web/controller/#{req.params.filename}?_method=DELETE') Delete

  .row
    .col-lg-12
      textarea.code-editor.full-height(name='source', data-mode='javascript')= source

script.
  var form = $('##{formid}')
  form.on('submit', function(e) {
    e.preventDefault()
    var textarea = form.find('textarea')
    var editor = textarea.data('CodeMirrorInstance')
    textarea.val(editor.getValue())

    $.ajax({
      url: form.attr('action'),
      type: form.attr('method'),
      data: form.serialize(),
      dataType: 'json',
      success: function(data) {
        var method = form.find('[name=method]').val()
        var path = form.find('[name=path]').val()
        var name = method+' '+path
        tabManager.updateCurrentTabName(name)
        tabManager.refreshOverview()
      },
    })
  })

  form.on('click', '.btn-danger', function(e) {
    e.preventDefault()
    var url = $(this).attr('data-url')
    swal({
      title: 'Are you sure?',
      type: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#DD6B55',
      confirmButtonText: 'Yes, delete it!',
      closeOnConfirm: false
    }, function() {
      $.ajax({
        url: url,
        type: 'post',
        dataType: 'json',
        success: function(data) {
          swal('Deleted!', 'The file has been deleted', 'success')
          tabManager.closeActiveTab()
          tabManager.refreshOverview()
        },
      })
    })
  })
